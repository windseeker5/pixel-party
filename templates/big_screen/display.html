<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bonne f√™te Val√©rie!</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- daisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.24/dist/full.min.css" rel="stylesheet">
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <!-- Google Fonts for elegant script -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pinyon+Script&family=Tangerine:wght@400;700&family=Allura&display=swap" rel="stylesheet">
    
    <style>
        /* Remove all margins and padding for full screen */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        /* Elegant script font for title */
        .birthday-title {
            font-family: 'Allura', cursive;
            background: linear-gradient(135deg, #ff6b9d, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Animated background for welcome screen */
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .animated-gradient {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        /* Full screen photo container with smooth transitions */
        .photo-container {
            height: calc(100vh - 140px);
        }


        
        
        /* Mini control buttons */
        .mini-control {
            padding: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .mini-control:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-base-300 m-0 p-0">
    <!-- Main Big Screen Layout - Full Screen -->
    <div class="min-h-screen h-screen w-screen flex flex-col m-0 p-0 bg-base-300">
        <!-- Dark Header with proper height -->
        <div class="bg-base-300 text-white shadow-lg px-3 py-4 h-24">
            <div class="grid grid-cols-4 gap-3 h-full">
                <!-- Left section with title centered in photo area -->
                <div class="col-span-3 flex items-center">
                    <!-- Title centered in this 3-column area -->
                    <div class="flex-1 text-center">
                        <h1 class="birthday-title text-5xl font-bold whitespace-nowrap">
                            Bonne f√™te Val√©rie!
                        </h1>
                    </div>
                </div>
                
                <!-- Icons and clock on the right -->
                <div class="col-span-1 flex gap-3 justify-end items-center">
                    <!-- Clock moved to right -->
                    <div class="text-gray-400 text-sm font-medium" id="current-time"></div>

                    <!-- Current URL Display -->
                    <div class="flex flex-col items-end">
                        <div class="text-xs text-gray-500 mb-1">QR Code URL:</div>
                        <div class="text-xs font-mono text-green-400 bg-gray-800 px-2 py-1 rounded truncate max-w-48"
                             id="current-url"
                             title="Current QR code URL">
                            Loading...
                        </div>
                    </div>

                    <!-- Admin Management Icon -->
                    <button class="btn btn-ghost btn-sm btn-circle" onclick="window.location.href='/admin/manage'" title="Admin Management">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                    </button>
                    <!-- Memory Book Icon -->
                    <button class="btn btn-ghost btn-sm btn-circle" onclick="window.location.href='/admin/export'" title="Memory Book">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
                        </svg>
                    </button>
                    <!-- Logout Icon -->
                    <button class="btn btn-ghost btn-sm btn-circle" onclick="window.location.href='/logout'" title="Logout">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-400">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content Area - Full Width -->
        <div class="flex-1 grid grid-cols-4 gap-3 p-3 bg-base-300">
            <!-- Photo Display - 75% width -->
            <div class="col-span-3 photo-container" id="photo-display">
                
                <!-- Welcome Screen (shown when no photos) -->
                <div id="welcome-screen" class="hero h-full animated-gradient rounded-xl shadow-2xl">
                    <div class="hero-content text-center w-full">
                        <div class="max-w-4xl w-full">
                            <h1 class="text-5xl font-bold text-white mb-3 drop-shadow-lg animate-pulse text-center">
                                Bienvenue √† la f√™te de Val√©rie
                            </h1>
                            <h2 class="text-4xl font-bold text-yellow-300 mb-6 drop-shadow-lg text-center">
                                50e anniversaire!
                            </h2>
                            <p class="text-xl text-white mb-8 drop-shadow text-center">
                                Partagez vos photos, v≈ìux et musique
                            </p>

                            <!-- QR Code Card - Centered -->
                            <div class="flex justify-center max-w-md mx-auto">
                                <!-- QR Code Card -->
                                <div class="card bg-white/95 backdrop-blur p-8 shadow-2xl">
                                    <div class="card-body items-center text-center p-0 flex flex-col justify-center h-full">
                                        <div id="qr-code" class="mb-4"></div>
                                        <h3 class="text-lg font-bold text-gray-800">Partagez un moment</h3>
                                        <p class="text-xs text-gray-500 mt-1" id="mobile-url"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Photo Content (populated via HTMX) -->
                <div id="photo-content" class="hidden h-full" 
                     hx-get="/api/current_photo" 
                     hx-trigger="every 8s"
                     hx-swap="innerHTML">
                    <!-- Photos will be loaded here -->
                </div>
            </div>

            <!-- Sidebar - 25% width -->
            <div class="col-span-1 space-y-2 overflow-y-auto">
                <!-- Compact Music Player matching other cards -->
                <div class="card bg-base-200 shadow-xl">
                    <div class="card-body p-2">
                        <div class="flex items-center justify-between mb-1">
                            <div>
                                <h2 class="card-title text-sm flex items-center gap-1">
                                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                                    </svg>
                                    Ambiance sugg√©r√©e par
                                </h2>
                                <!-- Submitter Info - Right below "Now Playing" title -->
                                <div class="flex items-center gap-2" id="submitter-info" style="display: none;">
                                    <div class="font-bold text-pink-400" id="submitter-name" style="font-size: 1.5625rem;">Elizabeth</div>
                                </div>
                                <!-- Wish message below name -->
                                <div class="text-sm italic text-gray-300 mt-1 pr-8 leading-5" id="submitter-wish" style="display: none;">
                                </div>
                            </div>
                            <!-- Larger QR Code for when photos start -->
                            <div id="mini-qr-container" class="hidden">
                                <div id="mini-qr" class="w-32 h-32 bg-white p-1 rounded-lg shadow-lg"></div>
                            </div>
                        </div>
                        
                        <!-- Song Info - Compact -->
                        <div class="mb-1">
                            <div class="text-xs font-medium truncate" id="song-title">Ready to Party!</div>
                            <div class="text-xs opacity-60 truncate" id="song-artist">Add songs from your phone</div>
                        </div>
                        
                        <!-- Mini Progress Bar -->
                        <div class="w-full bg-gray-700 rounded-full h-1 mb-1">
                            <div class="bg-pink-500 h-1 rounded-full transition-all" id="progress-bar" style="width: 0%"></div>
                        </div>
                        
                        <!-- Compact Controls in one line -->
                        <div class="flex items-center justify-between gap-1">
                            <!-- Play controls - DEAD SIMPLE -->
                            <div class="flex items-center gap-1">
                                <button class="mini-control" id="prev-btn">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                                    </svg>
                                </button>
                                <button class="mini-control" id="play-pause-btn">
                                    <svg id="play-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                    <svg id="pause-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                    </svg>
                                </button>
                                <button class="mini-control" id="next-btn">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Time -->
                            <div class="text-xs opacity-50">
                                <span id="current-time-display">0:00</span>
                            </div>
                        </div>
                        
                        <!-- Hidden audio element -->
                        <audio id="audio-player" class="hidden" preload="auto"></audio>
                    </div>
                </div>

                <!-- Music Queue -->
                <div class="card bg-base-200 shadow-xl">
                    <div class="card-body p-2">
                        <h2 class="card-title text-sm mb-1">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                            Music Queue
                        </h2>
                        <div id="music-queue" hx-get="/api/music_queue" hx-trigger="every 5s">
                            <!-- Music queue items -->
                        </div>
                    </div>
                </div>

                <!-- Photo Queue -->
                <div class="card bg-base-200 shadow-xl">
                    <div class="card-body p-2">
                        <h2 class="card-title text-sm mb-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Photo Queue
                        </h2>
                        <div id="photo-queue" hx-get="/api/photos/queue" hx-trigger="every 5s">
                            <!-- Photo thumbnails -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Minimal Dark Footer - No Guests -->
        <footer class="bg-base-300 text-gray-400 p-2">
            <div class="grid grid-cols-4 gap-3">
                <!-- Stats centered in the photo area (first 3 columns) -->
                <div class="col-span-3 flex justify-center space-x-6 text-xs">
                    <div class="flex items-center space-x-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span id="photo-count">0 Photos</span>
                    </div>
                    <div class="flex items-center space-x-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                        </svg>
                        <span id="music-count">0 Songs</span>
                    </div>
                </div>
                <!-- Empty right column to match header layout -->
                <div class="col-span-1"></div>
            </div>
        </footer>
    </div>
    
    <!-- QR Code Library -->
    <script src="https://unpkg.com/qrcode-generator@1.4.4/qrcode.js"></script>
    
    <script>
        let audioPlayer = null;
        let hasPhotos = false;

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize audio player
            audioPlayer = document.getElementById('audio-player');

            // Generate QR code with network IP
            generateQRCode();
            
            // Update clock
            updateClock();
            setInterval(updateClock, 1000);
            
            // Update stats
            updateStats();
            setInterval(updateStats, 5000);
            
            // Check for photos to start slideshow
            checkForPhotos();
            
            // Load current song (music queue handled by HTMX)
            loadCurrentSong();
            
            // Setup audio player event listeners
            setupAudioPlayer();
        });
        
        function generateQRCode() {
            // Fetch network info to get correct IP address
            fetch('/api/network_info')
                .then(response => response.json())
                .then(data => {
                    const qr = qrcode(4, 'L');
                    const url = data.mobile_url;
                    qr.addData(url);
                    qr.make();
                    
                    // Generate main QR code for welcome screen (doubled size)
                    const qrElement = document.getElementById('qr-code');
                    if (qrElement) {
                        qrElement.innerHTML = qr.createImgTag(6); // Reduced from 9 to 6
                    }
                    
                    // Generate larger QR for music player (when photos start)
                    const miniQrElement = document.getElementById('mini-qr');
                    if (miniQrElement) {
                        const miniQr = qrcode(4, 'L');
                        miniQr.addData(url);
                        miniQr.make();
                        miniQrElement.innerHTML = miniQr.createImgTag(8);  // Increased from 6 to 8 for bigger QR
                    }
                    
                    // Display URL
                    const urlElement = document.getElementById('mobile-url');
                    if (urlElement) {
                        urlElement.textContent = url;
                    }

                    // Update header URL display
                    const headerUrlElement = document.getElementById('current-url');
                    if (headerUrlElement) {
                        // Show the source and URL
                        const sourceText = data.url_source === 'external_setting' ? 'üåê External' : 'üè† Auto-IP';
                        headerUrlElement.textContent = `${sourceText}: ${url}`;
                        headerUrlElement.title = `QR code URL (${data.url_source}): ${url}`;

                        // Update styling based on source
                        if (data.url_source === 'external_setting') {
                            headerUrlElement.className = 'text-xs font-mono text-blue-400 bg-gray-800 px-2 py-1 rounded truncate max-w-48';
                        } else {
                            headerUrlElement.className = 'text-xs font-mono text-green-400 bg-gray-800 px-2 py-1 rounded truncate max-w-48';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching network info:', error);

                    // Update header URL display with error
                    const headerUrlElement = document.getElementById('current-url');
                    if (headerUrlElement) {
                        headerUrlElement.textContent = '‚ùå Network Error';
                        headerUrlElement.className = 'text-xs font-mono text-red-400 bg-gray-800 px-2 py-1 rounded truncate max-w-48';
                        headerUrlElement.title = 'Failed to fetch network info';
                    }
                });
        }
        
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour12: true,
                hour: 'numeric',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('current-time').textContent = timeString;
        }
        
        function updateStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('photo-count').textContent = `${data.photos || 0} Photos`;
                    document.getElementById('music-count').textContent = `${data.music_requests || 0} Songs`;
                })
                .catch(error => console.error('Error updating stats:', error));
        }
        
        function checkForPhotos() {
            fetch('/api/photos')
                .then(response => response.json())
                .then(data => {
                    if (data.photos && data.photos.length > 0) {
                        if (!hasPhotos) {
                            hasPhotos = true;
                            // Hide welcome screen and show photo content
                            document.getElementById('welcome-screen').classList.add('hidden');
                            document.getElementById('photo-content').classList.remove('hidden');
                            
                            // Show mini QR code in music player
                            document.getElementById('mini-qr-container').classList.remove('hidden');
                            
                            // Start the HTMX polling if not already started
                            const photoContent = document.getElementById('photo-content');
                            if (!photoContent.hasAttribute('hx-trigger')) {
                                htmx.process(photoContent);
                            }
                        }
                    }
                })
                .catch(error => console.error('Error checking for photos:', error));
        }
        
        // Check for photos every 5 seconds
        setInterval(checkForPhotos, 5000);

        // Compact Music Player Functions
        function setupAudioPlayer() {
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('ended', nextSong);
            audioPlayer.addEventListener('play', () => updatePlayButton(true));
            audioPlayer.addEventListener('pause', () => updatePlayButton(false));
        }
        
        function updateProgress() {
            if (audioPlayer && audioPlayer.duration) {
                const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                document.getElementById('progress-bar').style.width = progress + '%';
                
                const current = formatTime(audioPlayer.currentTime);
                document.getElementById('current-time-display').textContent = current;
            }
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updatePlayButton(isPlaying) {
            document.getElementById('play-icon').classList.toggle('hidden', isPlaying);
            document.getElementById('pause-icon').classList.toggle('hidden', !isPlaying);
        }
        
        function togglePlay() {
            if (audioPlayer.src) {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                } else {
                    audioPlayer.pause();
                }
            } else {
                // Load and play the first song in queue
                loadCurrentSong();
            }
        }
        
        
        // Music queue is handled by HTMX polling, no JavaScript needed
        
        function loadCurrentSong() {
            fetch('/api/music/current')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('song-title').textContent = 'Ready to Party!';
                        document.getElementById('song-artist').textContent = 'Add songs from your phone';
                        document.getElementById('submitter-info').style.display = 'none';
                        document.getElementById('submitter-wish').style.display = 'none';
                        audioPlayer.src = '';
                    } else {
                        document.getElementById('song-title').textContent = data.title || 'Unknown Song';
                        document.getElementById('song-artist').textContent = data.artist || 'Unknown Artist';
                        
                        // Show submitter info
                        document.getElementById('submitter-name').textContent = data.guest_name || 'Anonymous';
                        document.getElementById('submitter-info').style.display = 'flex';

                        // Show real wish if available
                        const wishElement = document.getElementById('submitter-wish');
                        if (data.guest_wish) {
                            wishElement.textContent = data.guest_wish;
                            wishElement.style.display = 'block';
                        } else {
                            wishElement.style.display = 'none';
                        }
                        
                        if (data.file_url && audioPlayer.src !== window.location.origin + data.file_url) {
                            audioPlayer.src = data.file_url;
                            audioPlayer.load();
                            // Auto-play when loading a new song
                            audioPlayer.play().catch(e => {
                                console.log('Auto-play prevented:', e);
                            });
                        }
                    }
                })
                .catch(error => console.error('Error loading current song:', error));
        }
        
        // DEAD SIMPLE - Music control buttons
        document.getElementById('play-pause-btn').addEventListener('click', function() {
            if (audioPlayer && audioPlayer.src) {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                } else {
                    audioPlayer.pause();
                }
            }
        });

        document.getElementById('next-btn').addEventListener('click', function() {
            fetch('/api/music/next', { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                    if (data.file_url) {
                        // Update song info WITHOUT reloading
                        document.getElementById('song-title').textContent = data.title || 'Unknown Song';
                        document.getElementById('song-artist').textContent = data.artist || 'Unknown Artist';

                        // Update audio player
                        audioPlayer.src = data.file_url;
                        audioPlayer.load();
                        audioPlayer.play();

                        // Update submitter info if it exists
                        if (document.getElementById('submitter-name')) {
                            document.getElementById('submitter-name').textContent = data.guest_name || 'Anonymous';
                        }
                    } else {
                        alert('No songs ready yet. Still downloading...');
                    }
                })
                .catch(err => console.log('Next failed:', err));
        });

        document.getElementById('prev-btn').addEventListener('click', function() {
            fetch('/api/music/previous', { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                    if (data.file_url) {
                        // Update song info WITHOUT reloading
                        document.getElementById('song-title').textContent = data.title || 'Unknown Song';
                        document.getElementById('song-artist').textContent = data.artist || 'Unknown Artist';

                        // Update audio player
                        audioPlayer.src = data.file_url;
                        audioPlayer.load();
                        audioPlayer.play();

                        // Update submitter info if it exists
                        if (document.getElementById('submitter-name')) {
                            document.getElementById('submitter-name').textContent = data.guest_name || 'Anonymous';
                        }
                    } else {
                        alert('No previous song available');
                    }
                })
                .catch(err => console.log('Previous failed:', err));
        });
    </script>
</body>
</html>